# DMR - Docker 项目备份与恢复工具



------



### 简介



**DMR**（Docker Manage & Restore） 是一款专为 Docker 环境设计的交互式命令行工具，旨在简化 Docker 容器及其相关数据的备份与恢复过程。无论您的 Docker 项目是通过 `docker-compose` 部署，还是由独立的 `docker run` 命令启动，DMR 都能帮助您轻松地捕获项目配置、持久化数据卷以及绑定挂载的数据，并在需要时将其恢复到原位或新的服务器上。

DMR 的目标是提供一个用户友好的菜单驱动界面，让 Docker 项目的备份和迁移工作变得高效、可靠。



### 主要功能



- **智能服务识别**：自动检测当前正在运行的 Docker 服务，并支持通过容器 ID、名称或镜像名称进行备份。
- **多类型备份支持**：
  - **Docker Compose 项目**：备份完整的 `docker-compose.yml` 文件及所有相关数据卷和绑定挂载数据。
  - **独立 Docker 容器**：智能重构并记录原始 `docker run` 命令，同时备份容器的持久化数据。
- **全面的数据备份**：
  - **命名卷 (Named Volumes)**：备份所有与容器关联的命名卷数据。
  - **绑定挂载 (Bind Mounts)**：备份宿主机上所有与容器关联的绑定挂载路径数据。
- **自动化依赖检查与安装**：首次运行时，DMR 会自动检查并尝试安装所需的系统依赖（如 `jq`, `tar`, `gzip`, `docker`），简化在新环境中的部署。
- **详细日志记录**：所有操作均会记录到 `/home/docker_backups/docker_backup_restore.log` 文件中，方便审计和问题排查。
- **清晰的备份管理**：提供列表功能，清晰展示所有可用备份文件的大小、创建时间、所属项目及完整文件名。
- **交互式菜单导航**：用户可以通过简单的数字输入选择操作，并在任何子菜单中输入 `0` 返回主菜单。


**更新功能**

1.全局注册‘dmr’为快捷命令唤醒此脚本

2.支持多个服务同时备份，第一个输完回车确认，输入'y'继续添加，输入'n'停止添加

3.恢复服务只能单个服务进行恢复，多服务恢复可能导致某些冲突，本人能力有限没法解决

4.添加删除备份功能，添加为每个备份的Docker服务生成执行命令并保存与docker_run_commands.txt文档中

4.备份、恢复、删除均添加'all'选项，更方便操作

5.添加一件执行命令，让使用更方便简洁

6.代码完全透明，全程由AI搓出来的脚本，有能力的自己添加新功能





## 如何使用

**一键命令**

```
curl -fsSL https://raw.githubusercontent.com/xymn2023/DMR/main/docker_back.sh -o docker_back.sh && chmod +x docker_back.sh && ./docker_back.sh
```




1. 下载脚本：

   将 DMR 脚本内容保存为 docker_back.sh 文件。

2. **添加执行权限**：

   Bash

   ```
   chmod +x docker_back.sh
   ```

3. 运行 DMR：

   强烈建议使用 sudo 权限运行脚本，以便进行依赖安装和 Docker 操作。

   Bash

   ```
   sudo ./docker_back.sh
   ```

4. **根据菜单提示操作**：

   - 选择 `1` 进行 Docker 服务的备份。
   - 选择 `2` 从已有备份中恢复 Docker 服务。
   - 选择 `3` 查看备份/恢复日志。
   - 选择 `4` 列出所有可用的备份文件。
   - 在任何子菜单中输入 `0` 可返回主菜单。
   - 选择 `5` 退出脚本。



### 注意事项



- **权限**：DMR 脚本需要 `sudo` 权限来执行 Docker 命令和管理系统文件。
- **备份路径**：所有备份文件默认存储在 `/home/docker_backups` 目录下。请确保该目录有足够的磁盘空间。
- **数据库备份**：DMR 会备份数据库容器的数据卷（物理文件），但对于生产环境，**强烈建议结合使用数据库自带的逻辑备份工具**（如 `mysqldump`, `pg_dump`）来确保数据一致性，并将逻辑备份文件也放置在数据卷或绑定挂载路径中，以便 DMR 一并备份。
- **恢复风险**：恢复操作可能会**停止并替换目标服务器上同名的现有容器**。在执行恢复前，请务必确认并谨慎操作。
- **绑定挂载路径**：恢复绑定挂载的数据时，请确保目标宿主机上存在相应的目录结构。DMR 会尝试创建这些目录，但如果权限不足或路径冲突，可能需要手动干预。



### 贡献与反馈



DMR 旨在成为一个实用且易于使用的工具。如果您有任何功能建议、优化意见或遇到问题，欢迎提出。您的反馈是改进 DMR 的最大动力。

------



